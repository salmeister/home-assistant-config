#!/bin/bash
# Shell script to copy entity registry for Copilot reference
# Run this inside your Home Assistant Docker container

# Default paths - adjust if needed
HA_CONFIG_PATH="${1:-/config}"
OUTPUT_FILE="${2:-entity_registry_snapshot.json}"

SOURCE_FILE="../.storage/core.entity_registry"
DEST_FILE="..//$OUTPUT_FILE"

if [ -f "$SOURCE_FILE" ]; then
    cp "$SOURCE_FILE" "$DEST_FILE"
    echo "Entity registry copied to $OUTPUT_FILE"
    
    # Count entities using jq if available, otherwise use basic count
    if command -v jq &> /dev/null; then
        ENTITY_COUNT=$(jq '.data.entities | length' "$DEST_FILE" 2>/dev/null || echo "unknown")
        echo "File contains $ENTITY_COUNT entities"
    else
        echo "Entity registry file copied successfully (jq not available for entity count)"
    fi
    
    # Set appropriate permissions
    chmod 644 "$DEST_FILE"
    echo "File permissions set to 644"
else
    echo "Error: Source file not found: $SOURCE_FILE"
    echo "Make sure you're running this inside the Home Assistant container"
    echo "or provide the correct config path as the first argument"
    exit 1
fi
