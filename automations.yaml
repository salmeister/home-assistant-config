- id: 339e07474928412f98de9d594163f0ff
  alias: Dawn Settings
  triggers:
  - event: sunrise
    offset: -00:10:00
    trigger: sun
  actions:
  - entity_id: scene.Dawn
    action: scene.turn_on
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - entity_id: switch.fish_tank_light
    action: switch.turn_on
- id: 34d19e4e28744d10bf2eeba67c8c9652
  alias: Dust Settings
  triggers:
  - event: sunset
    offset: +00:15:00
    trigger: sun
  actions:
  - entity_id: scene.Dusk
    alias: Activate Dust Scene
    action: scene.turn_on
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.empty_house
        state: 'off'
      - condition: time
        before: '21:00:00'
        after: 00:00:00
      sequence:
      - data:
          entity_id: light.foyer
          brightness: 50
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: binary_sensor.empty_house
        state: 'on'
      sequence:
      - data:
          entity_id: light.foyer
          brightness: 180
        action: light.turn_on
    alias: Turn on Foyer Light
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: or
          conditions:
          - condition: state
            entity_id: sensor.next_holiday
            state: Christmas Day
          - condition: state
            entity_id: sensor.next_holiday
            state: Christmas Day (Observed)
          - condition: state
            entity_id: sensor.next_holiday
            state: New Year's Day
          - condition: state
            entity_id: sensor.next_holiday
            state: New Year's Day (Observed)
      - condition: numeric_state
        entity_id: sensor.outdoor_temp
        below: 50
      sequence:
      - entity_id: switch.front_lights
        action: switch.turn_on
    alias: Turn On Front Lights
  - choose:
    - conditions:
      - condition: state
        state: open
        entity_id: cover.garage_doors
      sequence:
      - data:
          message: It is getting dark and the garage door is still open.
          target:
          - kitchen
          - basement
          - entryway
        action: notify.google_assistant_sdk
      # Create a helper for Google Hub interaction
      - data: {}
        target:
          entity_id: input_boolean.garage_hub_notification_active
        action: input_boolean.turn_on
      # Send visual notification to kitchen hub with action
      - data:
          message: "Garage door is open. Say 'Hey Google, close the garage door' or use the dashboard."
          data:
            display_url: "https://ha.salmeister.com/lovelace/garage-control"
          target:
          - kitchen
        action: notify.google_assistant_sdk
      - parallel:
        # Send actionable notification to Andy if enabled
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.notify_fpm_andy
              state: 'on'
            sequence:
            - data:
                title: "Garage Door Open"
                message: "It's getting dark and the garage door is still open."
                data:
                  tag: "garage_open_dark"
                  persistent: true
                  actions:
                  - action: "close_garage_door"
                    title: "Close Garage"
                  - action: "ignore_garage_notification"
                    title: "Ignore"
              action: notify.mobile_app_salmob1
        # Send actionable notification to Katie if enabled
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.notify_fpm_katie
              state: 'on'
            sequence:
            - data:
                title: "Garage Door Open"
                message: "It's getting dark and the garage door is still open."
                data:
                  tag: "garage_open_dark"
                  persistent: true
                  actions:
                  - action: "close_garage_door"
                    title: "Close Garage"
                  - action: "ignore_garage_notification"
                    title: "Ignore"
              action: notify.mobile_app_salmob2
    alias: Notify Garage Open
- id: b903ec6aacd748959d03f2b1d38f2e2d
  alias: Garage Door Basic Controls
  description: 'Handle immediate physical responses when garage door opens - lights, status indicators, location updates'
  triggers:
  - entity_id:
    - cover.garage_doors
    from: closed
    to: opening
    trigger: state
  - entity_id:
    - cover.garage_doors
    from: closed
    to: open
    trigger: state
  conditions: []
  actions:
  - parallel:
    - alias: Request location update
      action: notify.all_mobile_devices
      data:
        message: request_location_update
    - choose:
      - conditions: []
        sequence:
        - delay:
            hours: 0
            minutes: 2
            seconds: 0
            milliseconds: 0
        - condition: state
          entity_id: cover.garage_doors
          state: open
        - condition: state
          entity_id: light.back_entry
          state: 'off'
        - data:
            rgb_color:
            - 250
            - 0
            - 0
          target:
            entity_id: light.back_entry
          action: light.turn_on
      alias: Garage Status Light
    - choose:
      - conditions: []
        sequence:
        - entity_id: switch.garage_lights
          action: switch.turn_on
      alias: Garage Light
- id: enhanced_garage_door_person_detection
  alias: Enhanced Garage Door Person Detection
  description: 'Smart notifications using Frigate events with GenAI summaries and face recognition. Handles all garage security notifications when door is open and person detected.'
  triggers:
  - trigger: mqtt
    topic: frigate/events
  conditions:
  - condition: template
    value_template: >-
      {{ trigger.payload_json.after.camera == 'garage' and 
         trigger.payload_json.after.label == 'person' and
         trigger.payload_json.type == 'new' and
         trigger.payload_json.after.has_snapshot == true }}
  - condition: state
    entity_id: cover.garage_doors
    state: 'open'
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.external_armed_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'on'
    - condition: and
      conditions:
      - condition: template
        value_template: '{{states(''person.andy'') != ''home''}}'
      - condition: template
        value_template: '{{states(''person.katie'') != ''home''}}'
  actions:
  - variables:
      camera_name: "{{ trigger.payload_json.after.camera }}"
      event_id: "{{ trigger.payload_json.after.id }}"
      event_label: "{{ trigger.payload_json.after.label }}"
      sub_labels: "{{ trigger.payload_json.after.sub_label | default([]) if trigger.payload_json.after.sub_label is not none else [] }}"
      base_url: "https://ha.salmeister.com"
      client_id: ""
      session_tag: "garage_session_{{ now().strftime('%Y%m%d_%H%M') }}"
  # Wait to collect multiple people and AI data before sending notification
  - delay: "00:00:15"
  # Wait for person occupancy to ensure we get a clear snapshot
  - wait_for_trigger:
    - entity_id:
      - binary_sensor.garage_person_occupancy
      to: 'on'
      trigger: state
    timeout:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
    continue_on_timeout: true
    alias: Wait up to 2 minutes for clear person detection
  - variables:
      # Collect all recent garage events to group people
      all_people: >-
        {% set ns = namespace(people=[]) %}
        {% if sub_labels is not none and sub_labels | length > 0 %}
          {% for label in sub_labels %}
            {% if label not in ['person', 'unknown'] %}
              {% set ns.people = ns.people + [label | title] %}
            {% endif %}
          {% endfor %}
        {% endif %}
        {% if ns.people | length == 0 %}
          {% set ns.people = ['Unknown Person'] %}
        {% endif %}
        {{ ns.people | unique | list }}
      people_text: >-
        {% if all_people | length == 1 %}
          {{ all_people[0] }}
        {% elif all_people | length == 2 %}
          {{ all_people[0] }} and {{ all_people[1] }}
        {% else %}
          {{ all_people[:-1] | join(', ') }}, and {{ all_people[-1] }}
        {% endif %}
      # Use Frigate event snapshot for the actual detection image
      snapshot_url: "{{ base_url }}/api/frigate/notifications/{{ event_id }}/snapshot.jpg"
      clip_url: "{{ base_url }}/api/frigate{{ client_id }}/notifications/{{ event_id }}/{{ camera_name }}/clip.mp4"
  # Wait for potential GenAI description
  - wait_for_trigger:
    - trigger: mqtt
      topic: frigate/tracked_object_update
    timeout: "00:00:05"
    continue_on_timeout: true
  - variables:
      ai_description: >-
        {% if wait.trigger and wait.trigger.payload_json.id == event_id and wait.trigger.payload_json.type == 'description' %}
          {{ wait.trigger.payload_json.description }}
        {% else %}
          AI description not available
        {% endif %}
  # Send single consolidated notification to both parents
  - parallel:
    # Send actionable notification to Andy if enabled
    - choose:
      - conditions:
        - condition: state
          entity_id: input_boolean.notify_fpm_andy
          state: 'on'
        sequence:
        - action: notify.mobile_app_salmob1
          data:
            title: "üöó Garage Entry Detected"
            message: >-
              {{ people_text }} entered the garage.
              {% if ai_description != 'AI description not available' %}
              
              ü§ñ {{ ai_description }}
              {% endif %}
              
              üìç Time: {{ now().strftime('%I:%M %p') }}
            data:
              tag: "{{ session_tag }}"
              group: "garage_security"
              sticky: true
              channel: "garage_alerts"
              importance: high
              image: "{{ snapshot_url }}"
              clickAction: "{{ snapshot_url }}"
              url: "{{ snapshot_url }}"
              actions:
              - action: "VIEW_GARAGE_CLIP"
                title: "View"
              - action: "DISMISS_GARAGE_ALERT"
                title: "Dismiss"
    # Send actionable notification to Katie if enabled
    - choose:
      - conditions:
        - condition: state
          entity_id: input_boolean.notify_fpm_katie
          state: 'on'
        sequence:
        - action: notify.mobile_app_salmob2
          data:
            title: "üöó Garage Entry Detected"
            message: >-
              {{ people_text }} entered the garage.
              {% if ai_description != 'AI description not available' %}
              
              ü§ñ {{ ai_description }}
              {% endif %}
              
              üìç Time: {{ now().strftime('%I:%M %p') }}
            data:
              tag: "{{ session_tag }}"
              group: "garage_security" 
              sticky: true
              channel: "garage_alerts"
              importance: high
              image: "{{ snapshot_url }}"
              clickAction: "{{ snapshot_url }}"
              url: "{{ snapshot_url }}"
              actions:
              - action: "VIEW_GARAGE_CLIP"
                title: "View"
              - action: "DISMISS_GARAGE_ALERT"
                title: "Dismiss"
  mode: single

- id: handle_enhanced_garage_actions
  alias: Handle Enhanced Garage Actions
  description: 'Handle all garage notification actions including video viewing'
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: VIEW_GARAGE_CLIP
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: DISMISS_GARAGE_ALERT
  actions:
  # Log the action for debugging
  - action: system_log.write
    data:
      message: "Garage action received: {{ trigger.event.data.action }} from {{ trigger.event.data.sourceDeviceID }}, tag: {{ trigger.event.data.tag | default('no tag') }}"
      level: info
  - choose:
    - conditions:
      - condition: template
        value_template: "{{ trigger.event.data.action == 'VIEW_GARAGE_CLIP' }}"
      sequence:
      - variables:
          base_url: "https://ha.salmeister.com"
          # Open Frigate web interface with garage camera filter and recent events
          frigate_events_url: "{{ base_url }}:5000/events?cameras=garage&labels=person"
      # Send a notification with URI action to open Frigate
      - action: notify.{{ trigger.event.data.sourceDeviceID }}
        data:
          title: "üé¨ Opening Garage Events"
          message: "Tap to view recent garage events in Frigate"
          data:
            tag: "garage_video_link"
            actions:
            - action: "URI"
              title: "Open Frigate"
              uri: "{{ frigate_events_url }}"
    - conditions:
      - condition: template
        value_template: "{{ trigger.event.data.action == 'DISMISS_GARAGE_ALERT' }}"
      sequence:
      # Clear the notification using the original tag
      - action: notify.{{ trigger.event.data.sourceDeviceID }}
        data:
          message: "clear_notification"
          data:
            tag: "{{ trigger.event.data.tag | default('') }}"
      # Send confirmation
      - action: notify.{{ trigger.event.data.sourceDeviceID }}
        data:
          title: "‚úÖ Alert Dismissed"
          message: "Garage security alert has been dismissed"
          data:
            tag: "garage_dismiss_confirm"
            timeout: 3
  mode: parallel

# DEBUG: Test automation to catch garage-specific mobile app notification actions
- id: debug_garage_mobile_app_actions
  alias: Debug Garage Mobile App Notification Actions
  description: 'Catch garage-related mobile app notification actions for debugging'
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: VIEW_GARAGE_CLIP
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: DISMISS_GARAGE_ALERT
  actions:
  - action: system_log.write
    data:
      message: "DEBUG: Garage action detected: {{ trigger.event.data }}"
      level: warning
  - action: persistent_notification.create
    data:
      title: "üîß DEBUG: Garage Action Detected"
      message: |
        Action: {{ trigger.event.data.action }}
        Device: {{ trigger.event.data.sourceDeviceID }}
        Tag: {{ trigger.event.data.tag | default('none') }}
        Time: {{ now().strftime('%H:%M:%S') }}
      notification_id: "debug_garage_action"
  mode: parallel

- id: af0c4a0821ad44af8e99ac7e98e28964
  alias: Garage Door Left Open While Home Alone
  triggers:
  - entity_id: cover.garage_doors
    to: open
    trigger: state
  conditions:
  - condition: state
    state: open
    for:
      hours: 0
      minutes: 5
      seconds: 0
    entity_id: cover.garage_doors
  - condition: and
    conditions:
    - condition: template
      value_template: '{{states(''person.andy'') != ''home''}}'
    - condition: template
      value_template: '{{states(''person.katie'') != ''home''}}'
  actions:
  - data:
      message: The garage door with close in 5 minutes.
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
  - delay: 00:05:00
  - data:
      entity_id: cover.garage_doors
    action: cover.close_cover
- id: fc8165e67f0f423b9d6ca5e7f1c1c40e
  alias: Early Night Tasks
  description: ''
  triggers:
  - at: '21:00:00'
    trigger: time
  actions:
  - parallel:
    - choose:
      - conditions:
        - condition: state
          entity_id: switch.fish_tank_light
          state: 'on'
        sequence:
        - entity_id: switch.fish_tank_light
          action: switch.turn_off
      alias: Turn Off Aquarium
    - choose:
      - conditions:
        - condition: state
          entity_id: binary_sensor.workday_evening
          state: 'on'
        sequence:
        - delay:
            hours: 1
            minutes: 15
            seconds: 0
            milliseconds: 0
        - data: {}
          target:
            entity_id:
            - switch.piano_room_counter_lights
            - switch.piano_room_lamp
            - switch.holiday_plug_2
            - switch.holiday_plug_1
          action: switch.turn_off
      alias: Workday Shutdown
    - choose:
      - conditions:
        - condition: state
          entity_id: binary_sensor.empty_house
          state: 'off'
        sequence:
        - entity_id: light.foyer
          action: light.turn_off
      alias: Turn Off Foyer Light
- id: 7117193270954e6eb43c8385f30e1601
  alias: Midnight Tasks
  triggers:
  - at: '23:30:00'
    trigger: time
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - input_boolean.andy_vitamins
      - input_boolean.morning_startup_done
      - input_boolean.unload_dishwasher
    alias: Turn Off Booleans
  - entity_id:
    - switch.piano_room_counter_lights
    - switch.piano_room_lamp
    - switch.holiday_plug_1
    - switch.holiday_plug_2
    - switch.maggie_holiday_lights
    action: switch.turn_off
  - entity_id: lock.porch_door, lock.front_door
    action: lock.lock
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.full_house
        state: 'on'
      sequence:
      - entity_id: switch.front_lights
        action: switch.turn_off
      - condition: template
        value_template: '{{ states(''media_player.non_bedroom_tvs'') == ''off'' }}'
        alias: If TVs are Off
      - condition: template
        value_template: '{{ states(''binary_sensor.no_main_motion_for_15_min'') ==
          ''off'' }}'
        alias: If No Motion on the Main Floor
      - data: {}
        action: script.house_shutdown
  - condition: and
    conditions:
    - condition: state
      entity_id: light.foyer
      state: 'on'
    - condition: state
      entity_id: binary_sensor.empty_house
      state: 'on'
  - data:
      entity_id: light.foyer
      brightness: 50
    action: light.turn_on
- id: 97d60c81420a458e9449957382c2548a
  alias: Lock Door When Home Alone
  triggers:
  - entity_id: person.andy
    zone: zone.home
    event: leave
    trigger: zone
  - entity_id: person.katie
    zone: zone.home
    event: leave
    trigger: zone
  conditions:
  - condition: and
    conditions:
    - condition: not
      conditions:
      - condition: zone
        entity_id: person.andy
        zone: zone.home
      - condition: zone
        entity_id: person.katie
        zone: zone.home
    - condition: or
      conditions:
      - condition: template
        value_template: '{{ states.proximity.andy_home.attributes.dir_of_travel ==
          ''away_from'' }}'
      - condition: template
        value_template: '{{ states.proximity.katie_home.attributes.dir_of_travel ==
          ''away_from'' }}'
  actions:
  - entity_id: lock.porch_door, lock.front_door
    action: lock.lock
- id: 58504e66d5674cabb654d27d638af17b
  alias: Low Temp in Basement
  triggers:
  - entity_id:
    - sensor.water_valve_air_temperature
    below: 55
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: numeric_state
  actions:
  - data:
      message: Low Temp detected in the basement.
    action: notify.parent_mobile_devices
  - data:
      message: Low Temp detected in the basement.
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
  mode: single
- id: 74fbfdf16c0543ff98596e8288316912
  alias: Low Temp on Main Floor
  triggers:
  - entity_id:
    - sensor.laundry_water_leak_air_temperature
    below: 55
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: numeric_state
  actions:
  - data:
      message: Low Temp detected in the laundry room.
    action: notify.parent_mobile_devices
  - data:
      message: Low Temp detected in the laundry room.
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
- id: 117da4c1812d453d981c186ca07f21ac
  alias: Water Detected in Basement
  triggers:
  - entity_id:
    - binary_sensor.water_valve_water_alarm_water_leak_detected
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - data: {}
    target:
      entity_id: switch.water_valve
    action: switch.turn_on
  - data:
      message: Water detected in the basement. Water turned off.
    action: notify.parent_mobile_devices
  - data:
      message: Water detected in the basement. Water turned off.
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
  mode: single
- id: 8a71726e99574cf09627a8950829a762
  alias: Water Detected near Fridge
  triggers:
  - entity_id:
    - binary_sensor.fridge_leak_water_alarm_water_leak_detected
    to: 'on'
    from: 'off'
    trigger: state
  actions:
  - data: {}
    target:
      entity_id: switch.water_valve
    action: switch.turn_on
  - data:
      message: The ice maker is leaking. Water turned off.
    action: notify.parent_mobile_devices
  - data:
      message: The ice maker is leaking. Water turned off.
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
  mode: single
- id: cd8c5de487e14aaaa3d2e7ad7fc200b8
  alias: Water Detected in Laundry Room
  triggers:
  - entity_id:
    - binary_sensor.laundry_water_leak_water_alarm_water_leak_detected
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - data: {}
    target:
      entity_id: switch.water_valve
    action: switch.turn_on
  - data:
      message: Water detected in the laundry room. Water turned off.
    action: notify.parent_mobile_devices
  - data:
      message: Water detected in the laundry room. Water turned off.
      target:
      - kitchen
      - basement
      - entryway
    enabled: true
    action: notify.google_assistant_sdk
  mode: single
- id: cd8c5de487e14aaaa3d2e7ad7fa200b7
  alias: Water Detected under Kitchen Sink
  triggers:
  - entity_id:
    - binary_sensor.kitchen_water_leak_detected
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - data: {}
    target:
      entity_id: switch.water_valve
    action: switch.turn_on
  - data:
      message: Water detected under kitchen sink. Water turned off.
    action: notify.parent_mobile_devices
  - data:
      message: Water Detected under Kitchen Sink. Water turned off.
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
  mode: single
- id: 3299820bd1fb4ba898026043614260f4
  alias: Fire Alarm
  triggers:
  - entity_id:
    - switch.fire_alarm
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - data:
      message: The fire alarm is going off!
    action: notify.parent_mobile_devices
  - data:
      message: Fire! Fire! Fire!
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
- id: 89505984bd644e09b890af787c915437
  alias: Water Softener Low
  triggers:
  - at: '11:00:00'
    trigger: time
  conditions:
  - condition: numeric_state
    entity_id: sensor.water_softener_salt_level
    below: 35
  actions:
  - data:
      message: Time to go buy 4 bags of water softener salt.
      title: Water softener salt is low.
    action: notify.gmail_email_andy
- id: e7f95523f1054b7488368f9d2928dbb4
  alias: Sump Level
  triggers:
  - entity_id: sensor.sump_level
    above: 20
    for:
      seconds: 125
    trigger: numeric_state
  - entity_id: sensor.sump_level
    above: 30
    for:
      seconds: 125
    trigger: numeric_state
  - entity_id: sensor.sump_level
    above: 40
    for:
      seconds: 125
    trigger: numeric_state
  - entity_id: sensor.sump_level
    above: 50
    for:
      seconds: 125
    trigger: numeric_state
  - entity_id: sensor.sump_level
    above: 60
    for:
      seconds: 125
    trigger: numeric_state
  - entity_id: sensor.sump_level
    above: 70
    for:
      seconds: 125
    trigger: numeric_state
  - entity_id: sensor.sump_level
    above: 80
    for:
      seconds: 125
    trigger: numeric_state
  - entity_id: sensor.sump_level
    above: 90
    for:
      seconds: 125
    trigger: numeric_state
  - entity_id: sensor.sump_level
    above: 100
    for:
      seconds: 125
    trigger: numeric_state
  actions:
  - data:
      message: Water is rising in the sump basin!
    action: notify.parent_mobile_devices
  - data:
      message: Water is rising in the sump basin!
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
- id: 99d6e8b097a74eb1a12867c415500bcd
  alias: Update House Status
  triggers:
  - at: 09:00:00
    trigger: time
  - at: '22:30:00'
    trigger: time
  - event: start
    trigger: homeassistant
  actions:
  - entity_id: input_boolean.bedtime
    action: "{% set minutes = ((now().strftime('%H') | int) * 60) + (now().strftime('%M')
      | int) %} {% if (360 <= minutes < 1410) and (is_state('sensor.dayoftheweek',
      'Friday')) %}\n  input_boolean.turn_off\n{% elif (480 <= minutes < 1410) and
      (is_state('sensor.dayoftheweek', 'Saturday')) %}\n  input_boolean.turn_off \n{%
      elif (480 <= minutes < 1350) and (is_state('sensor.dayoftheweek', 'Sunday'))
      %}\n  input_boolean.turn_off \n{% elif (360 <= minutes < 1350) and ((is_state('sensor.dayoftheweek',
      'Monday')) or (is_state('sensor.dayoftheweek', 'Tuesday')) or (is_state('sensor.dayoftheweek',
      'Wednesday')) or (is_state('sensor.dayoftheweek', 'Thursday'))) %}\n  input_boolean.turn_off
      \n{% else %}\n  input_boolean.turn_on\n{% endif %}\n"
- id: c7208b98b0e9474a97ccbe9bd71d8473
  alias: Crock-Pot On
  triggers:
  - at: input_datetime.crock_pot_start_time
    trigger: time
  conditions:
  - condition: time
    after: 00:01:00
  actions:
  - entity_id: switch.crock_pot
    action: switch.turn_on
  - data:
      time: 00:00:00
    target:
      entity_id: input_datetime.crock_pot_start_time
    action: input_datetime.set_datetime
- id: d05b1353782f4bab862635a9d82a9b8e
  alias: Dishwasher Done
  triggers:
  - entity_id:
    - sensor.dishwasher_state
    from: drying
    to: none
    trigger: state
  actions:
  - entity_id: input_boolean.unload_dishwasher
    action: input_boolean.turn_on
- id: f9cc911c1d7c4d64b949869284942c52
  alias: Hassio Startup
  triggers:
  - event: start
    trigger: homeassistant
  actions:
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - action: homeassistant.update_entity
    data:
      entity_id:
      - sensor.plhs_lunch_0
      - sensor.plhs_lunch_1
      - sensor.plhs_lunch_2
      - sensor.plhs_lunch_3
      - sensor.plhs_lunch_4
      - sensor.plhs_lunch_5
- id: b1181b134261492db210649c6bd52831
  alias: Dogs Already Fed Check
  triggers:
  - entity_id:
    - binary_sensor.dog_food_contact
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.dog_food_contact
    from: 'on'
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ (now().timestamp() - state_attr("input_datetime.dogs_last_fed",
          "timestamp")) < 10800 and (now().timestamp() - state_attr("input_datetime.dogs_last_fed",
          "timestamp")) > 60 }}'
      sequence:
      - data:
          message: The dogs may have already been fed.
          target:
          - kitchen
        action: notify.google_assistant_sdk
  - choose:
    - conditions: []
      sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 2
          milliseconds: 0
      - metadata: {}
        data:
          timestamp: '{{ now().timestamp() }}'
        target:
          entity_id: input_datetime.dogs_last_fed
        action: input_datetime.set_datetime
- id: '1608167974470'
  alias: Main Bath Night Light
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.master_bath_switch_motion
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  - entity_id:
    - binary_sensor.master_bath_switch_motion
    to: 'off'
    from: 'on'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    trigger: state
  conditions:
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: sun
        after: sunset
        after_offset: '1:00:00'
      - condition: sun
        before: sunrise
    - condition: or
      conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: switch.master_night_light
          state: 'off'
        - condition: template
          value_template: '{{ trigger.to_state.state == ''on'' }}'
      - condition: and
        conditions:
        - condition: state
          entity_id: switch.master_night_light
          state: 'on'
        - condition: template
          value_template: '{{ trigger.to_state.state == ''off'' }}'
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      - condition: state
        entity_id: switch.master_bath
        state: 'off'
      sequence:
      - entity_id: switch.master_night_light
        action: switch.turn_on
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - entity_id: switch.master_night_light
        action: switch.turn_off
  mode: single
- id: '1608167975561'
  alias: Up Bath Night Light
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.up_bath_switch_motion
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.up_bath_switch_motion
    to: 'off'
    from: 'on'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: state
        entity_id: switch.up_bath_night_light
        state: 'off'
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
    - condition: and
      conditions:
      - condition: state
        entity_id: switch.up_bath_night_light
        state: 'on'
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - entity_id: switch.up_bath_night_light
        action: switch.turn_on
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - entity_id: switch.up_bath_night_light
        action: switch.turn_off
  mode: single
- id: '1608237220910'
  alias: Unload Dishwasher Reminder
  description: ''
  triggers:
  - at: '15:20:00'
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.unload_dishwasher
    state: 'on'
  actions:
  - data:
      message: Time to unload the dishwasher.
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
  mode: single
- id: '1616783648058'
  alias: House Wake Up
  description: ''
  triggers:
  - entity_id: input_boolean.bedtime
    to: 'off'
    trigger: state
  conditions:
  - condition: time
    after: 04:00:00
    before: '10:30:00'
  actions:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.empty_house
          state: 'off'
        - condition: state
          entity_id: binary_sensor.school_day
          state: 'off'
      sequence:
      - entity_id:
        - switch.holiday_plug_1
        - switch.holiday_plug_2
        action: switch.turn_on
      - delay:
          hours: 0
          minutes: 15
          seconds: 0
          milliseconds: 0
      - condition: template
        value_template: '{% if (now().timestamp() - state_attr("input_datetime.dogs_last_fed",
          "timestamp")) > 10800 %}true{% endif %}'
      - data:
          message: The dogs need to be fed.
          target:
          - kitchen
        action: notify.google_assistant_sdk
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.full_armed_mode
        state: 'off'
      sequence:
      - target:
          entity_id: input_boolean.external_armed_mode
        data: {}
        action: input_boolean.turn_off
  mode: single
- id: '1632516039646'
  alias: Liquor Cabinet Opened
  description: ''
  triggers:
  - type: opened
    device_id: 310cbb462be7d0c4fffd3314321c711c
    entity_id: ce2b6e85fd594e1990af0bfbd940f8bd
    domain: binary_sensor
    trigger: device
  - type: opened
    device_id: 4a947c58ff0a98615bee4adf44db2dd1
    entity_id: binary_sensor.right_liquor_cabinet_contact
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: not
    conditions:
    - condition: zone
      entity_id: person.andy
      zone: zone.home
      enabled: true
  - condition: and
    conditions:
    - condition: not
      conditions:
      - condition: zone
        entity_id: person.katie
        zone: zone.home
  actions:
  - data:
      message: The liquor cabinet opened
      cameraURL: /api/camera_proxy/camera.kitchen
    action: script.notify_parents_with_picture
  mode: single
- id: '1632516039727'
  alias: School Morning Routine
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.up_stairs_motion_occupancy
    to: 'on'
    alias: Motion Detected on the Upstairs Stairs
  - trigger: state
    entity_id:
    - binary_sensor.back_entry_switch_motion
    to: 'on'
  conditions:
  - alias: There is someone home, it is a school day, it is after 6am
    condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.morning_startup_done
      state: 'off'
    - condition: state
      entity_id: binary_sensor.empty_house
      state: 'off'
    - condition: state
      entity_id: binary_sensor.school_day
      state: 'on'
    - condition: time
      after: 06:00:00
      before: 07:45:00
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  actions:
  - parallel:
    - alias: Instance Startup
      choose:
      - conditions: []
        sequence:
        - data: {}
          target:
            entity_id: input_boolean.morning_startup_done
          alias: Set to Is Running
          action: input_boolean.turn_on
        - data: {}
          target:
            entity_id: input_boolean.bedtime
          alias: Turn off House Sleep Mode
          action: input_boolean.turn_off
        - data:
            entity_id:
            - switch.kitchen_counters
            - switch.island_lights
            - switch.holiday_plug_1
            - switch.holiday_plug_2
          action: switch.turn_on
    - alias: Feed the Dogs Reminder
      choose:
      - conditions: []
        sequence:
        - delay:
            hours: 0
            minutes: 5
            seconds: 0
            milliseconds: 0
        - condition: template
          value_template: '{% if (now().timestamp() - state_attr("input_datetime.dogs_last_fed",
            "timestamp")) > 10800 %}true{% endif %}'
        - data:
            message: The dogs need to be fed.
            target:
            - kitchen
          action: notify.google_assistant_sdk
    - alias: Its Dark Outside
      choose:
      - conditions:
        - condition: sun
          before: sunrise
          before_offset: -00:30:00
        sequence:
        - wait_for_trigger:
          - trigger: time
            at: 06:45:00
          continue_on_timeout: false
          timeout:
            hours: 1
            minutes: 0
            seconds: 0
            milliseconds: 0
        - condition: sun
          before: sunrise
          before_offset: -00:30:00
        - target:
            entity_id:
            - switch.lower_foyer
            - switch.front_lights
          data: {}
          action: switch.turn_on
    - choose:
      - conditions:
        - condition: numeric_state
          entity_id: sensor.outdoor_temp
          below: 45
        sequence:
        - wait_for_trigger:
          - entity_id:
            - binary_sensor.floor_lamps_switch_motion
            to: 'on'
            trigger: state
        - data: {}
          target:
            entity_id:
            - switch.floor_lamps
            - switch.fireplace
          action: switch.turn_on
        - data: {}
          target:
            entity_id:
            - light.living_room
          action: light.turn_on
        - delay:
            hours: 1
            minutes: 10
            seconds: 0
            milliseconds: 0
        - target:
            entity_id: switch.fireplace
          data: {}
          action: switch.turn_off
      - conditions:
        - condition: numeric_state
          entity_id: sensor.outdoor_temp
          above: 44
        sequence:
        - wait_for_trigger:
          - entity_id:
            - binary_sensor.floor_lamps_switch_motion
            to: 'on'
            trigger: state
        - data: {}
          target:
            entity_id:
            - switch.floor_lamps
          action: switch.turn_on
        - data: {}
          target:
            entity_id:
            - light.living_room
          action: light.turn_on
      alias: Turn on Living Room
    - alias: Shutdown
      choose:
      - conditions: []
        sequence:
        - wait_for_trigger:
          - trigger: time
            at: 07:35:00
          timeout:
            hours: 2
            minutes: 0
            seconds: 0
            milliseconds: 0
          continue_on_timeout: false
          alias: Wait Until 7:35am
        - data: {}
          target:
            entity_id: switch.fireplace
          action: switch.turn_off
          alias: Turn off Fireplace
        - delay:
            hours: 0
            minutes: 25
            seconds: 0
            milliseconds: 0
        - choose:
          - conditions:
            - condition: numeric_state
              entity_id: zone.home
              below: 2
            sequence:
            - data: {}
              action: switch.turn_off
              target:
                entity_id:
                - switch.lower_foyer
                - switch.island_lights
            alias: Just 1 Person Home
          alias: Shutdown Kitchen and Entry
        - choose:
          - conditions:
            - condition: state
              entity_id: binary_sensor.floor_lamps_switch_motion
              state: 'off'
              for:
                hours: 0
                minutes: 2
                seconds: 0
            sequence:
            - data:
                entity_id:
                - switch.floor_lamps
              action: switch.turn_off
            - data:
                entity_id:
                - light.living_room
              action: light.turn_off
          alias: Shutdown Living Room
  mode: single
- id: '1634573031535'
  alias: No One Home
  triggers:
  - entity_id:
    - binary_sensor.empty_house
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 2
      seconds: 0
    trigger: state
  actions:
  - target:
      entity_id: scene.full_shutdown
    metadata: {}
    action: scene.turn_on
    data: {}
  - data: {}
    target:
      entity_id: switch.kitchen_counters
    action: switch.turn_off
- id: '1634573031424'
  alias: Full Armed
  description: ''
  triggers:
  - entity_id: input_boolean.full_armed_mode
    to: 'on'
    trigger: state
  - entity_id:
    - input_boolean.full_armed_mode
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.external_armed_mode
        action: input_boolean.turn_on
      - data: {}
        target:
          entity_id:
          - switch.kitchen_detect
          - switch.garage_detect
        action: switch.turn_on
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.external_armed_mode
        action: input_boolean.turn_off
      - data: {}
        target:
          entity_id:
          - switch.kitchen_detect
          - switch.garage_detect
        action: switch.turn_off
  mode: single
- id: '1634573431119'
  alias: Kitchen Full Armed Motion
  description: ''
  use_blueprint:
    path: SgtBatten/Stable.yaml
    input:
      camera: camera.kitchen
      notify_device: ecca2a5c378d7feaa416ec4ae00b1a4e
      notify_group: parent_mobile_devices
      base_url: https://ha.salmeister.com
      critical: 'false'
      alert_once: true
      update_thumbnail: true
      labels:
      - person
      message: Motion detected in the kitchen
      state_filter: false
      state_filter_states: []
      presence_filter:
      - ''
- id: '1646231634423'
  alias: Tag - Vitamins is scanned
  description: ''
  triggers:
  - event_type: tag_scanned
    event_data:
      tag_id: 6d626df7-626a-4662-9aed-f5f72d547f36
    context: {}
    trigger: event
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.device_id == ''901b2da2be65ec01867dc4fd65d496ba''
          }}'
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.andy_vitamins
        action: input_boolean.turn_on
  mode: single
- id: '1646232250701'
  alias: Evening Tasks
  description: ''
  triggers:
  - at: '18:00:00'
    trigger: time
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.andy_vitamins
        state: 'off'
      sequence:
      - data:
          message: Don't forget your vitamins today
        action: notify.mobile_app_salmob1
    alias: Vitamin Reminder
  - delay:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - condition: template
    value_template: '{% if (now().timestamp() - state_attr("input_datetime.dogs_last_fed",
      "timestamp")) > 10800 %}true{% endif %}'
    alias: Feed Dog Reminder
  - data:
      message: The dogs need to be fed.
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
  mode: single
- id: '1657892984595'
  alias: 'Front Closet: Contact Sensor Toggle Lights'
  description: ''
  use_blueprint:
    path: salmeister/contact_sensor_toggle_lights.yaml
    input:
      contact_sensor: binary_sensor.front_closet_contact
      target_lights:
        entity_id: light.front_closet
      time_out_seconds: 300
- id: '1657893021577'
  alias: 'Basement Stairs Closet: Contact Sensor Toggle Lights'
  description: ''
  use_blueprint:
    path: salmeister/contact_sensor_toggle_lights.yaml
    input:
      contact_sensor: binary_sensor.basement_stairs_closet_contact
      target_lights:
        entity_id: light.basement_stairs_closet
      time_out_seconds: 300
- id: '1657893076010'
  alias: 'Basement Bedroom Closet: Contact Sensor Toggle Lights'
  description: ''
  use_blueprint:
    path: salmeister/contact_sensor_toggle_lights.yaml
    input:
      contact_sensor: binary_sensor.basement_bedroom_closet_contact
      target_lights:
        entity_id: light.basement_bedroom_closet
      time_out_seconds: 300
- id: '1732866971344'
  alias: Refresh Zwave Battery Levels
  description: Poll all battery powered devices to update their battery levels
  triggers:
  - at: 00:00:00
    trigger: time
  conditions:
  - condition: time
    weekday:
    - sun
  actions:
  - data:
      entity_id:
      - group.zwave_battery_level_group
    action: zwave_js.refresh_value
  mode: single
- id: '1658425165735'
  alias: 'Basement Stairs: ZEN32 (Z-Wave JS)'
  description: ''
  use_blueprint:
    path: fxlt/zen32-scene-controller-z-wave-js.yaml
    input:
      zooz_switch: 55a4c6305fd65cf4a02b1e2223f1985a
      scene_1:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.basement_main_upper_lights
      scene_2:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.basement_main_lower_lights
      scene_4:
      - service: script.turn_on
        data: {}
        target:
          entity_id: script.turn_off_basement_lights
      scene_5: []
      scene_3:
      - service: light.turn_on
        data: {}
        target:
          entity_id:
          - light.all_basement_downlights
      - service: switch.turn_on
        data: {}
        target:
          entity_id:
          - switch.basement_stairs
      scene_32: []
      scene_42: []
      scene_33: []
      scene_43: []
      scene_1h:
      - service: script.basement_lights_to_warm_modify_active_lights
        metadata: {}
        data: {}
      scene_2h:
      - service: script.basement_lights_to_cool_modify_active_lights
        metadata: {}
        data: {}
- id: '1658436009563'
  alias: Blueprint - Vacation Lighting
  description: ''
  use_blueprint:
    path: salmeister/vacation_lighting.yaml
    input:
      vacation_mode_toggle: input_boolean.vacation_mode
      replay_sensor_1: sensor.replay_floor_lamps
      light_target_1: switch.floor_lamps
      replay_sensor_2: sensor.replay_front_lights
      light_target_2: switch.front_lights
      replay_sensor_3: sensor.replay_living_room_lights
      light_target_3: light.living_room
      replay_sensor_4: sensor.replay_table_lights
      light_target_4: light.table_lights
      replay_sensor_5: sensor.replay_island_lights
      light_target_5: switch.island_lights
      replay_sensor_6: sensor.replay_porch_door_light
      light_target_6: switch.porch_door_light
      replay_sensor_7: sensor.replay_porch_light
      light_target_7: light.porch_fan
      replay_sensor_8: sensor.replay_kitchen_counters
      light_target_8: switch.kitchen_counters
      replay_sensor_9: sensor.replay_kitchen_cabinets
      light_target_9: switch.kitchen_cabinets
      replay_sensor_10: sensor.replay_fireplace_lights
      light_target_10: light.fireplace_lights
- id: '1658436267671'
  alias: Vacation Mode Toggle
  description: ''
  triggers:
  - entity_id:
    - input_boolean.vacation_mode
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    trigger: state
  - entity_id:
    - input_boolean.vacation_mode
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.full_armed_mode
        action: input_boolean.turn_on
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.full_armed_mode
        action: input_boolean.turn_off
  mode: single
- id: '1658501349187'
  alias: Front Walk Frigate Notify Andy
  description: ''
  use_blueprint:
    path: SgtBatten/Stable.yaml
    input:
      camera:
      - camera.front_porch
      notify_device: ecca2a5c378d7feaa416ec4ae00b1a4e
      base_url: https://ha.salmeister.com
      critical: 'false'
      alert_once: true
      update_thumbnail: true
      zone_filter: true
      zones:
      - front_walk
      cooldown: 300
      sound: none
      update_sub_label: false
      sticky: true
      presence_filter:
      - ''
      video: '{{base_url}}/api/frigate{{client_id}}/notifications/{{id}}/{{camera}}/clip.mp4'
- id: '1658507839970'
  alias: External Armed Mode
  description: ''
  triggers:
  - entity_id:
    - input_boolean.external_armed_mode
    to: 'on'
    trigger: state
  - entity_id:
    - input_boolean.external_armed_mode
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - data: {}
        target:
          entity_id:
          - automation.front_yard_external_armed_motion
          - automation.driveway_external_armed_motion
        action: automation.turn_on
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - data: {}
        target:
          entity_id:
          - automation.driveway_external_armed_motion
          - automation.front_yard_external_armed_motion
        action: automation.turn_off
  mode: single
- id: '1658507916923'
  alias: Driveway External Armed Motion
  description: ''
  use_blueprint:
    path: SgtBatten/Stable.yaml
    input:
      camera: camera.driveway
      notify_device: ecca2a5c378d7feaa416ec4ae00b1a4e
      notify_group: parent_mobile_devices
      base_url: https://ha.salmeister.com
      critical: 'false'
      zone_filter: true
      zones:
      - south_front_yard
      labels:
      - person
      alert_once: true
      update_thumbnail: true
- id: '1658507916934'
  alias: Front Yard External Armed Motion
  description: ''
  use_blueprint:
    path: SgtBatten/Stable.yaml
    input:
      camera: camera.front_porch
      notify_device: ecca2a5c378d7feaa416ec4ae00b1a4e
      notify_group: parent_mobile_devices
      base_url: https://ha.salmeister.com
      critical: 'false'
      alert_once: true
      update_thumbnail: true
      zone_filter: true
      zones:
      - north_front_yard
      labels:
      - person
- id: '1658513335370'
  alias: Notify Andy
  description: ''
  triggers:
  - entity_id:
    - input_boolean.notify_fpm_andy
    to: 'on'
    trigger: state
  - entity_id:
    - input_boolean.notify_fpm_andy
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - data: {}
        target:
          entity_id: automation.front_walk_frigate_notify_andy
        action: automation.turn_on
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - data: {}
        target:
          entity_id: automation.front_walk_frigate_notify_andy
        action: automation.turn_off
  mode: single
- id: '1658513504160'
  alias: Front Walk Frigate Notify Katie
  description: ''
  use_blueprint:
    path: SgtBatten/Stable.yaml
    input:
      camera: camera.front_porch
      notify_device: 7f64dbef8d1ab27c9bc1ab438f89c9aa
      critical: 'true'
      alert_once: true
      update_thumbnail: true
      zone_filter: true
      zones:
      - front_walk
      cooldown: 300
- id: '1658513596545'
  alias: Notify Katie
  description: ''
  triggers:
  - entity_id:
    - input_boolean.notify_fpm_katie
    to: 'on'
    trigger: state
  - entity_id:
    - input_boolean.notify_fpm_katie
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - data: {}
        target:
          entity_id: automation.front_walk_frigate_notify_katie
        action: automation.turn_on
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - data: {}
        target:
          entity_id: automation.front_walk_frigate_notify_katie
        action: automation.turn_off
  mode: single
- id: '1659569878935'
  alias: 'Basement TV Lower Lights: Zen76'
  description: ''
  use_blueprint:
    path: salmeister/zooz_zen76_smartlight_config.yaml
    input:
      node_id: 71
      target_light: light.basement_tv_lower_lights
      on_1x:
      - service: light.turn_on
        data: {}
        target:
          entity_id:
          - light.basement_tv_lower_lights
      already_on_already_bright_1x: []
      already_on_not_bright_1x: []
      on_2x: []
      off_1x:
      - service: light.turn_off
        data: {}
        target:
          entity_id:
          - light.basement_tv_lower_lights
      off_2x: []
- id: '1659646178142'
  alias: 'Bar Lights: Zooz Zen76 Control Smart Light Configuration'
  description: ''
  use_blueprint:
    path: salmeister/zooz_zen76_smartlight_config.yaml
    input:
      node_id: 75
      target_light: light.bar_lights
      on_1x:
      - service: light.turn_on
        data: {}
        target:
          entity_id: light.bar_lights
      already_on_already_bright_1x: []
      already_on_not_bright_1x: []
      on_2x: []
      on_3x: []
      off_1x:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.bar_lights
      off_2x: []
      off_3x: []
- id: '1659649442998'
  alias: 'Basement Main: Zooz Zen76 Control Smart Light Configuration'
  description: ''
  use_blueprint:
    path: salmeister/zooz_zen76_smartlight_config.yaml
    input:
      node_id: 68
      target_light: light.basement_main_lights
      on_1x:
      - service: light.turn_on
        data: {}
        target:
          entity_id: light.basement_main_lights
      already_on_already_bright_1x:
      - service: script.turn_on
        data: {}
        target:
          entity_id: script.basement_main_to_dim_modify_active_lights
      already_on_not_bright_1x:
      - service: script.turn_on
        data: {}
        target:
          entity_id: script.basement_main_to_bright_modify_active_lights
      on_2x:
      - service: script.turn_on
        data: {}
        target:
          entity_id: script.basement_main_step_up_brightness_modify_active_lights
      off_1x:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.basement_main_lights
      off_2x:
      - service: script.turn_on
        data: {}
        target:
          entity_id: script.basement_main_step_up_brightness_modify_active_lights_2
- id: '1659723616359'
  alias: Turn Off Basement Color Loop
  description: ''
  triggers:
  - entity_id:
    - light.all_basement_downlights
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: script.basement_color_loop
    state: 'on'
  actions:
  - data: {}
    target:
      entity_id: script.basement_color_loop
    action: script.turn_off
  mode: single
- id: '1665776755860'
  alias: Zooz Porch Light
  description: ''
  use_blueprint:
    path: salmeister/zooz_zen76_smartlight_config.yaml
    input:
      node_id: 52
      target_light: light.porch_fan
      on_1x:
      - service: light.turn_on
        data:
          brightness_pct: 100
        target:
          entity_id: light.porch_fan
- id: '1665776755472'
  alias: Torrent completed
  description: Notify and remove torrent upon completion
  triggers:
  - event_type: transmission_downloaded_torrent
    trigger: event
    context: {}
  actions:
  - data:
      title: Torrent completed!
      message: '{{trigger.event.data.name}}'
    action: notify.mobile_app_salmob1
  - data:
      name: Transmission
      id: '{{trigger.event.data.id}}'
    action: transmission.remove_torrent
- id: '1670420137860'
  alias: 'Piano Room: ZEN32 (ZwaveJS)'
  description: ''
  use_blueprint:
    path: fxlt/zen32-scene-controller-z-wave-js.yaml
    input:
      zooz_switch: c68efc11ec22fb1c3c879a00d80da8b3
      scene_1:
      - data: {}
        target:
          entity_id: switch.piano_room_counter_lights
        action: switch.toggle
      scene_2:
      - data: {}
        target:
          entity_id: switch.piano_room_interior_cabinet
        action: switch.toggle
      scene_4:
      - condition: sun
        after: sunset
      - data: {}
        target:
          entity_id: script.house_shutdown
        action: script.turn_on
      scene_5: []
      scene_3:
      - action: switch.toggle
        metadata: {}
        data: {}
        target:
          entity_id: switch.piano_room_lamp
      scene_32: []
      scene_42: []
      scene_33: []
      scene_43: []
- id: '1673906074263'
  alias: Laundry Room Motion
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.laundry_motion_motion_detection
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.laundry_motion_motion_detection
    to: 'off'
    from: 'on'
    for:
      hours: 0
      minutes: 3
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - data: {}
        target:
          entity_id: light.laundry_room
        action: light.turn_on
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - data: {}
        target:
          entity_id: light.laundry_room
        action: light.turn_off
  mode: single
- id: '1674508087688'
  alias: Returning to Empty Home
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.empty_house
    from: 'on'
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.bedtime
        state: 'off'
      sequence:
      - data: {}
        target:
          entity_id: switch.kitchen_counters
        action: switch.turn_on
      - condition: sun
        after: sunset
        after_offset: -00:20:00
      - data: {}
        target:
          entity_id:
          - switch.piano_room_counter_lights
          - switch.piano_room_lamp
          - switch.holiday_plug_1
          - switch.holiday_plug_2
        action: switch.turn_on
    - conditions:
      - condition: state
        entity_id: input_boolean.vacation_mode
        state: 'on'
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.vacation_mode
        action: input_boolean.turn_off
  mode: single
- id: '1674510642434'
  alias: Interior Motion Detected
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.back_entry_switch_motion
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.floor_lamps_switch_motion
    to: 'on'
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.full_armed_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.full_armed_mode
        state: 'on'
      sequence:
      - data:
          message: '{{ trigger.to_state.name }} detected motion'
        action: notify.parent_mobile_devices
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: input_boolean.bedtime
          state: 'on'
        - condition: state
          entity_id: binary_sensor.empty_house
          state: 'off'
        - condition: time
          after: 04:00:00
          before: '10:30:00'
      sequence:
      - entity_id: input_boolean.bedtime
        action: input_boolean.turn_off
  mode: single
- id: '1674514855376'
  alias: 'Basement Hall: Zooz Zen76 Control Smart Light Configuration'
  description: ''
  use_blueprint:
    path: salmeister/zooz_zen76_smartlight_config.yaml
    input:
      node_id: 90
      target_light: light.basement_hall
      on_1x:
      - service: light.turn_on
        data: {}
        target:
          entity_id: light.basement_hall
      off_1x:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.basement_hall
- id: '1674567806494'
  alias: Andy Phone Usage
  description: ''
  triggers:
  - entity_id:
    - sensor.andy_daily_phone_usage
    above: 3
    trigger: numeric_state
  - entity_id: sensor.andy_daily_phone_usage
    above: 4
    trigger: numeric_state
  - entity_id: sensor.andy_daily_phone_usage
    above: 5
    trigger: numeric_state
  - entity_id: sensor.andy_daily_phone_usage
    above: 6
    trigger: numeric_state
  conditions: []
  actions:
  - data:
      title: You have used {{ trigger.above }} hours of screen time today
      message: That is roughly {{ (((trigger.above / 16) | float) * 100) | round(0)
        }}% of your day
    action: notify.mobile_app_salmob1
  mode: single
- id: '1674571394391'
  alias: Katie Phone Usage
  description: ''
  triggers:
  - entity_id:
    - sensor.katie_daily_phone_usage
    above: 3
    trigger: numeric_state
  - entity_id: sensor.katie_daily_phone_usage
    above: 4
    trigger: numeric_state
  - entity_id: sensor.katie_daily_phone_usage
    above: 5
    trigger: numeric_state
  - entity_id: sensor.katie_daily_phone_usage
    above: 6
    trigger: numeric_state
  conditions: []
  actions:
  - data:
      title: You have used {{ trigger.above }} hours of screen time today
      message: That is roughly {{ (((trigger.above / 16) | float) * 100) | round(0)
        }}% of your day
    action: notify.mobile_app_salmob2
  mode: single
- id: '1674571487939'
  alias: Cam Phone Usage
  description: ''
  triggers:
  - entity_id:
    - sensor.cam_daily_phone_usage
    above: 3
    trigger: numeric_state
  - entity_id: sensor.cam_daily_phone_usage
    above: 4
    trigger: numeric_state
  - entity_id: sensor.cam_daily_phone_usage
    above: 5
    trigger: numeric_state
  - entity_id: sensor.cam_daily_phone_usage
    above: 6
    trigger: numeric_state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.above < 5 }}'
      sequence:
      - data:
          title: You have used {{ trigger.above }} hours of screen time today
          message: That is roughly {{ (((trigger.above / 16) | float) * 100) | round(0)
            }}% of your day
        action: notify.mobile_app_salmob4
    - conditions:
      - condition: template
        value_template: '{{ trigger.above > 4 }}'
      sequence:
      - data:
          title: You have used {{ trigger.above }} hours of screen time today
          message: That is roughly {{ (((trigger.above / 16) | float) * 100) | round(0)
            }}% of your day
        action: notify.mobile_app_salmob4
      - data:
          message: Cam has used {{ trigger.above }} hours of screen time today
        action: notify.mobile_app_salmob1
      - data:
          message: Cam has used {{ trigger.above }} hours of screen time today
        action: notify.mobile_app_salmob2
  mode: single
- id: '1674571487940'
  alias: Maggie Phone Usage
  description: ''
  triggers:
  - entity_id:
    - sensor.maggie_daily_phone_usage
    above: 3
    trigger: numeric_state
  - entity_id: sensor.maggie_daily_phone_usage
    above: 4
    trigger: numeric_state
  - entity_id: sensor.maggie_daily_phone_usage
    above: 5
    trigger: numeric_state
  - entity_id: sensor.maggie_daily_phone_usage
    above: 6
    trigger: numeric_state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.above < 5 }}'
      sequence:
      - data:
          title: You have used {{ trigger.above }} hours of screen time today
          message: That is roughly {{ (((trigger.above / 16) | float) * 100) | round(0)
            }}% of your day
        action: notify.mobile_app_salmob5
    - conditions:
      - condition: template
        value_template: '{{ trigger.above > 4 }}'
      sequence:
      - data:
          title: You have used {{ trigger.above }} hours of screen time today
          message: That is roughly {{ (((trigger.above / 16) | float) * 100) | round(0)
            }}% of your day
        action: notify.mobile_app_salmob5
      - data:
          message: Maggie has used {{ trigger.above }} hours of screen time today
        action: notify.mobile_app_salmob1
      - data:
          message: Maggie has used {{ trigger.above }} hours of screen time today
        action: notify.mobile_app_salmob2
  mode: single
- id: '1674575682770'
  alias: Cam School Night Phone Usage
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.salmob4_interactive
    to: 'on'
    from: 'off'
    for:
      hours: 0
      minutes: 3
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.school_night
    state: 'on'
  - condition: time
    after: '22:00:00'
  actions:
  - data:
      message: Cam is using his phone late on a school night
    action: notify.mobile_app_salmob1
  - data:
      message: Cam is using his phone late on a school night
    action: notify.mobile_app_salmob2
  - data:
      message: It is pretty late to be using your phone on a school night
    action: notify.mobile_app_salmob4
  mode: single
- id: '1674575682777'
  alias: Maggie School Night Phone Usage
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.salmob5_interactive
    to: 'on'
    from: 'off'
    for:
      hours: 0
      minutes: 3
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.school_night
    state: 'on'
  - condition: time
    after: '22:00:00'
  actions:
  - data:
      message: Maggie is using her phone late on a school night
    action: notify.mobile_app_salmob1
  - data:
      message: Maggie is using her phone late on a school night
    action: notify.mobile_app_salmob2
  - data:
      message: It is pretty late to be using your phone on a school night
    action: notify.mobile_app_salmob5
  mode: single
- id: '1674847821608'
  alias: Mid Morning Tasks
  description: Catch things when it should be bright out
  triggers:
  - event: sunrise
    offset: 02:00:00
    trigger: sun
  conditions:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: template
        value_template: '{{ ''12-24'' in now().date() | string }}'
      - condition: template
        value_template: '{{ ''12-25'' in now().date() | string }}'
      - condition: template
        value_template: '{{ ''12-31'' in now().date() | string }}'
      - condition: template
        value_template: '{{ ''01-01'' in now().date() | string }}'
  actions:
  - data: {}
    target:
      entity_id:
      - switch.lower_foyer
    action: switch.turn_off
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: or
          conditions:
          - condition: template
            value_template: '{{ ''12-24'' in now().date() | string }}'
          - condition: template
            value_template: '{{ ''12-25'' in now().date() | string }}'
          - condition: template
            value_template: '{{ ''12-31'' in now().date() | string }}'
          - condition: template
            value_template: '{{ ''01-01'' in now().date() | string }}'
      sequence:
      - data:
          entity_id:
          - switch.holiday_plug_2
          - switch.holiday_plug_1
          - switch.maggie_holiday_lights
        action: switch.turn_off
    alias: Holiday Items
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.floor_lamps_switch_motion
        state: 'off'
        for:
          hours: 0
          minutes: 2
          seconds: 0
      sequence:
      - data:
          entity_id:
          - switch.floor_lamps
        action: switch.turn_off
      - data:
          entity_id:
          - light.living_room
        action: light.turn_off
    alias: Living Room Items
  mode: single
- id: '1674859526763'
  alias: Middle of the Night Tasks
  description: Nothing good every happens after 2:00 AM
  triggers:
  - at: 02:00:00
    trigger: time
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.full_house
        state: 'on'
      sequence:
      - entity_id: switch.front_lights
        action: switch.turn_off
      - condition: template
        value_template: '{{ states(''media_player.non_bedroom_tvs'') == ''off'' }}'
        alias: If TVs are Off
      - condition: template
        value_template: '{{ states(''binary_sensor.no_main_motion_for_15_min'') ==
          ''off'' }}'
        alias: If No Motion on the Main Floor
      - data: {}
        action: script.house_shutdown
  mode: single
- id: '1674940514975'
  alias: Back Entry
  description: ''
  triggers:
  - entity_id:
    - switch.back_entry
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - switch.back_entry
    from: 'on'
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - target:
          entity_id:
          - light.back_entry
        data:
          color_temp_kelvin: 300
        action: light.turn_on
      - condition: state
        entity_id: switch.kitchen_counters
        state: 'off'
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.kitchen_counters
      - alias: Request location update
        action: notify.all_mobile_devices
        data:
          message: request_location_update
      - choose:
        - conditions:
          - condition: time
            after: 04:30:00
          sequence:
          - target:
              entity_id: input_boolean.bedtime
            action: input_boolean.turn_off
            data: {}
        - conditions:
          - condition: time
            after: 02:00:00
          sequence:
          - delay:
              minutes: 5
          - condition: state
            entity_id: binary_sensor.up_stairs_motion_occupancy
            state: 'off'
          - choose:
            - conditions:
              - condition: state
                entity_id: binary_sensor.up_stairs_motion_occupancy
                state: 'off'
              sequence:
              - target:
                  entity_id: switch.kitchen_counters
                action: switch.turn_off
                data: {}
            default:
            - delay:
                minutes: 5
            - target:
                entity_id: switch.kitchen_counters
              action: switch.turn_off
              data: {}
      alias: Back Entry Light to On
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
        alias: Back Entry Light to Off
      sequence:
      - if:
        - condition: state
          entity_id: cover.garage_doors
          state: open
        then:
        - data:
            rgb_color:
            - 250
            - 0
            - 0
          target:
            entity_id: light.back_entry
          action: light.turn_on
        else:
        - data: {}
          target:
            entity_id:
            - light.back_entry
          action: light.turn_off
  mode: parallel
- id: '1674942127235'
  alias: Garage Door Closed
  description: 'Reset back entry light from red to warm white when garage closes'
  triggers:
  - entity_id:
    - cover.garage_doors
    to: closing
    from: open
    trigger: state
  - entity_id:
    - cover.garage_doors
    to: closed
    from: open
    trigger: state
  conditions:
  - condition: state
    entity_id: light.back_entry
    state: 'on'
  - condition: or
    conditions:
    - condition: template
      value_template: '{{ state_attr(''light.back_entry'', ''rgb_color'') == [250, 0, 0] }}'
    - condition: template
      value_template: '{{ state_attr(''light.back_entry'', ''rgb_color'') == [255, 0, 0] }}'
  actions:
  - data: {}
    target:
      entity_id: light.back_entry
    action: light.turn_off
  mode: single
- id: '1675097486189'
  alias: 'Zwave: Always On Switches'
  description: ''
  use_blueprint:
    path: salmeister/switches_always_on.yaml
    input:
      target_switches:
      - switch.basement_tv_room_lights
      - switch.basement_tv_side_lights
      - switch.basement_main_lights
      - switch.basement_hall
      - switch.basement_bar_area_lights
      - switch.table_light
      - switch.living_room_lights
- id: '1677591531023'
  alias: Sump Pump Power
  description: ''
  triggers:
  - entity_id:
    - sensor.sump_level
    to: unavailable
    for:
      hours: 0
      minutes: 2
      seconds: 30
    trigger: state
  conditions: []
  actions:
  - data:
      message: Sump pump may not have power
    action: notify.parent_mobile_devices
  - data:
      message: Sump pump may not have power
      target:
      - kitchen
      - basement
      - entryway
    action: notify.google_assistant_sdk
  mode: single
- id: '1693235905492'
  alias: Washer Stuck
  description: If the washer goes from spin back to rinse, the load may be unbalanced
  triggers:
  - entity_id:
    - sensor.washer_washer_job_state
    from: spin
    to: rinse
    trigger: state
  conditions: []
  actions:
  - data:
      message: The washer may be uneven.
    action: notify.mobile_app_salmob1
  - data:
      message: The washer may be uneven.
    action: notify.mobile_app_salmob2
  - data:
      message: The washer may be uneven.
      target:
      - kitchen
    action: notify.google_assistant_sdk
  mode: single
- id: '1693313942878'
  alias: Main Bath Sync Switch & Nightlight
  description: ''
  triggers:
  - entity_id:
    - switch.master_bath
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: switch.master_night_light
    state: 'on'
  actions:
  - data: {}
    target:
      entity_id: switch.master_night_light
    action: switch.turn_off
  mode: single
- id: '1701097911082'
  alias: Fridge Power
  description: ''
  triggers:
  - entity_id:
    - switch.kitchen_cabinets
    to: unavailable
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      message: The fridge has no power
    action: notify.parent_mobile_devices
  mode: single
- id: '1701097996376'
  alias: Basement Fridge Power
  description: ''
  triggers:
  - entity_id:
    - switch.basement_peninsula_lights
    to: unavailable
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      message: The basement fridge has no power
    action: notify.parent_mobile_devices
  mode: single
- id: '1701099649452'
  alias: Calendar All Day Task Reminders
  description: ''
  triggers:
  - entity_id: calendar.salmelas
    event: start
    trigger: calendar
    offset: 0:0:0
  conditions:
  - condition: or
    conditions:
    - alias: Monthly
      condition: template
      value_template: '{{ trigger.calendar_event.all_day and ''#Monthly'' in trigger.calendar_event.summary
        }}'
    - alias: Quarterly
      condition: template
      value_template: '{{ trigger.calendar_event.all_day and ''#Quarterly'' in trigger.calendar_event.summary
        }}'
    - alias: Biannual
      condition: template
      value_template: '{{ trigger.calendar_event.all_day and ''#Biannually'' in trigger.calendar_event.summary
        }}'
    - alias: Yearly
      condition: template
      value_template: '{{ trigger.calendar_event.all_day and ''#Yearly'' in trigger.calendar_event.summary
        }}'
    - condition: template
      value_template: '{{ ''#Hourly'' in trigger.calendar_event.summary }}'
      alias: Hourly
  actions:
  - alias: Set up variables for the actions
    variables:
      reminder_id: '{{ ''REMINDER_'' ~ context.id }}'
  - alias: Prompt Reminder
    data:
      message: Event {{ trigger.calendar_event.summary }} -- {{     trigger.calendar_event.description
        }}
      data:
        persistent: true
        tag: '{{ reminder_id }}'
        group: calendar-notification-group
        actions:
        - action: '{{ reminder_id }}'
          title: Dismiss
    action: notify.mobile_app_salmob1
  - alias: Wait for a response
    wait_for_trigger:
    - event_type: mobile_app_notification_action
      event_data:
        action: '{{ reminder_id }}'
      trigger: event
  - alias: Perform the action
    choose:
    - conditions:
      - condition: template
        value_template: '{{ wait.trigger.event.data.action == reminder_id }}'
      sequence:
      - data:
          message: clear_notification
          data:
            tag: '{{ reminder_id }}'
        action: notify.mobile_app_salmob1
  mode: single
- id: '1701267214062'
  alias: Sync Bedtime and External Arm Mode
  description: ''
  triggers:
  - entity_id:
    - input_boolean.bedtime
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - entity_id: input_boolean.external_armed_mode
        action: input_boolean.turn_on
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - entity_id: input_boolean.external_armed_mode
        action: input_boolean.turn_off
  mode: single
- id: '1713532585047'
  alias: 'Living Room: Zen32'
  description: ''
  use_blueprint:
    path: fxlt/zen32-scene-controller-z-wave-js.yaml
    input:
      zooz_switch: e93643bd31e7c4ef387035ed48ac331d
      scene_5:
      - service: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.living_room
          - light.fireplace_lights
      scene_1:
      - service: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.fireplace_lights
      scene_2:
      - service: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.living_room
      scene_3:
      - service: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.living_room_north_row
      scene_4:
      - service: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.living_room_south_row
- id: '1713535013646'
  alias: 'Table Lights: Zen76'
  description: ''
  use_blueprint:
    path: salmeister/zooz_zen76_smartlight_config.yaml
    input:
      node_id: 53
      target_light: light.table_lights
      on_1x:
      - service: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.table_lights
      off_1x:
      - service: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.table_lights
- id: '1713536251979'
  alias: 'Basement TV Upper Lights: Zen76'
  description: ''
  use_blueprint:
    path: salmeister/zooz_zen76_smartlight_config.yaml
    input:
      node_id: 102
      target_light: light.basement_tv_upper_lights
      on_1x:
      - service: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.basement_tv_upper_lights
      off_1x:
      - service: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.basement_tv_upper_lights
- id: '1722260009248'
  alias: Phones Powered Off
  description: ''
  triggers:
  - at: 03:00:00
    trigger: time
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.salmob5_interactive
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      sequence:
      - data_template:
          entity_id: binary_sensor.salmob5_interactive
          state: 'off'
        action: python_script.set_state
      - data_template:
          entity_id: sensor.maggie_daily_phone_usage
          state: 0
        action: python_script.set_state
    - conditions:
      - condition: state
        entity_id: binary_sensor.salmob4_interactive
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      sequence:
      - data_template:
          entity_id: binary_sensor.salmob4_interactive
          state: 'off'
        action: python_script.set_state
      - data_template:
          entity_id: sensor.cam_daily_phone_usage
          state: 0
        action: python_script.set_state
    - conditions:
      - condition: state
        entity_id: binary_sensor.salmob2_interactive
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      sequence:
      - data_template:
          entity_id: binary_sensor.salmob2_interactive
          state: 'off'
        action: python_script.set_state
      - data_template:
          entity_id: sensor.katie_daily_phone_usage
          state: 0
        action: python_script.set_state
    - conditions:
      - condition: state
        entity_id: binary_sensor.salmob1_interactive
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      sequence:
      - data_template:
          entity_id: binary_sensor.salmob1_interactive
          state: 'off'
        action: python_script.set_state
      - data_template:
          entity_id: sensor.andy_daily_phone_usage
          state: 0
        action: python_script.set_state
  mode: single
- id: '1733772182232'
  alias: Late Night Motion Detection
  description: Turn on kitchen counters based on motion and bedtime, with time-based
    deactivation.
  triggers:
  - entity_id: binary_sensor.up_stairs_motion_occupancy
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.bedtime
    state: 'on'
  actions:
  - target:
      entity_id: switch.kitchen_counters
    action: switch.turn_on
    data: {}
  - choose:
    - conditions:
      - condition: time
        after: 04:30:00
      sequence:
      - target:
          entity_id: input_boolean.bedtime
        action: input_boolean.turn_off
        data: {}
      - condition: sun
        before: sunrise
        before_offset: 00:15:00
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.piano_room_lamp
    default:
    - delay:
        minutes: 5
    - condition: state
      entity_id: binary_sensor.up_stairs_motion_occupancy
      state: 'off'
    - choose:
      - conditions:
        - condition: state
          entity_id: binary_sensor.up_stairs_motion_occupancy
          state: 'off'
        sequence:
        - target:
            entity_id: switch.kitchen_counters
          action: switch.turn_off
          data: {}
      default:
      - delay:
          minutes: 5
      - target:
          entity_id: switch.kitchen_counters
        action: switch.turn_off
        data: {}
- id: '1733929064909'
  alias: Low Battery Email
  description: ''
  triggers:
  - at: 08:00:00
    trigger: time
  conditions:
  - condition: time
    weekday:
    - mon
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.zwave_battery_level_group
      below: 20
    - condition: numeric_state
      entity_id: sensor.zigbee_battery_level_group
      below: 20
  actions:
  - variables:
      battery_levels: "{%- set zwave_entities = state_attr('sensor.zwave_battery_level_group',
        'entity_id') | default([]) -%} {%- set zigbee_entities = state_attr('sensor.zigbee_battery_level_group',
        'entity_id') | default([]) -%} {%- set all_entities = zwave_entities + zigbee_entities
        -%} {%- set ns = namespace(battery_info=[]) -%} {%- for entity_id in all_entities
        -%}\n  {%- if states(entity_id) not in ['unavailable', 'unknown', 'none']
        and states(entity_id) | float(100) < 20 -%}\n    {%- set battery_info = ns.battery_info
        + [{\"name\": state_attr(entity_id, 'friendly_name')|default(entity_id.split('.')[1],
        true), \"value\": states(entity_id), \"type\": entity_id.split('.')[0]}] -%}\n
        \   {%- set ns.battery_info = battery_info -%}\n  {%- endif -%}\n{%- endfor
        -%} {{ ns.battery_info }}\n"
  - data:
      title: HA Battery Level Warning
      message: ''
      data:
        html: "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">
          <html lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\">\n  <head>\n    <meta
          charset=\"UTF-8\">\n    <meta http-equiv=\"Content-Type\" content=\"text/html;
          charset=UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,
          initial-scale=1.0\">\n    <title>Battery Alert</title>\n    <link rel=\"stylesheet\"
          href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css\">\n
          \   <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css\">\n
          \   <style type=\"text/css\">\n      @font-face {\n        font-family:
          'Open Sans';\n        font-style: normal;\n        font-weight: 300;\n        src:
          local('Open Sans Light'), local('OpenSans-Light'), url(http://fonts.gstatic.com/s/opensans/v13/DXI1ORHCpsQm3Vp6mXoaTZS3E-kSBmtLoNJPDtbj2Pk.ttf)
          format('truetype');\n      }\n      h1,h2,h3,h4,h5,h6 {\n        font-family:'Open
          Sans',Arial,sans-serif;\n        font-weight:400;\n        margin:10px 0\n
          \     }\n    </style>\n  </head>\n  <body>\n    <div class=\"jumbotron jumbotron-fluid\"
          style=\"background-color: #f00a2d; color: white;\">\n      <div class=\"container
          py-0\">\n        <h1>Low Battery Alert</h1>\n      </div>\n    </div>\n
          \   <div class=\"container-fluid\">\n      <div class=\"row\">\n        <div
          class=\"col-xs-12\">\n          <h3>Devices with Low Battery:</h3>\n          <ul>\n
          \         {%- for battery in battery_levels -%}\n            <li>{{ battery.type
          | upper }} - {{ battery.name }}: {{ battery.value }}%</li>\n          {%-
          else -%}\n            <li>No devices with low battery levels found.</li>\n
          \         {%- endfor -%}\n          </ul>\n          <p>\n            Review
          more at:\n            <a href=\"intent://lovelace/batteries#Intent;scheme=homeassistant;package=io.homeassistant.companion.android;end;fallback_url=https://ha.salmeister.com/lovelace/batteries\">Home
          Assistant</a>\n          </p>\n        </div>\n      </div>\n    </div>\n
          \ </body>\n</html>\n"
    action: notify.gmail_email_andy
  mode: single
- id: '1747060007889'
  alias: 'Porch Door: ZEN32 (Z-Wave JS)'
  description: ''
  use_blueprint:
    path: fxlt/zen32-scene-controller-z-wave-js.yaml
    input:
      zooz_switch: 4ef16f4d9bff22b35de758e86df728ca
      scene_1:
      - action: switch.toggle
        metadata: {}
        data: {}
        target:
          entity_id: switch.patio_light
      scene_2:
      - action: switch.toggle
        metadata: {}
        data: {}
        target:
          entity_id: switch.outdoor_lights
- id: '1747060007998'
  alias: Linkind Keypad Button Press
  description: Detects button presses from Linkind ZS130000178 and performs a dummy
    action
  triggers:
  - topic: zigbee2mqtt/LinkindKeypad
    trigger: mqtt
  conditions:
  - condition: template
    value_template: '{{ trigger.payload_json.action is defined }}'
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.payload_json.action == ''arm_day_zones'' }}'
      sequence:
      - data:
          entity_id: switch.piano_room_lamp
        action: switch.toggle
    - conditions:
      - condition: template
        value_template: '{{ trigger.payload_json.action == ''arm_all_zones'' }}'
      sequence:
      - data:
          entity_id: switch.piano_room_lamp
        action: switch.toggle
    - conditions:
      - condition: template
        value_template: '{{ trigger.payload_json.action == ''disarm'' }}'
      sequence:
      - data:
          entity_id: switch.piano_room_lamp
        action: switch.toggle
    - conditions:
      - condition: template
        value_template: '{{ trigger.payload_json.action == ''panic'' }}'
      sequence:
      - data:
          entity_id: switch.piano_room_lamp
        action: switch.toggle
    default: []
  mode: single
- id: 'garage_door_actionable_notifications'
  alias: Handle Garage Door Actionable Notifications
  description: Handle actionable notifications for garage door being open after dark
  triggers:
  # Handle notification actions
  - event_type: mobile_app_notification_action
    event_data:
      action: "close_garage_door"
    trigger: event
  - event_type: mobile_app_notification_action
    event_data:
      action: "ignore_garage_notification"
    trigger: event
  # Auto-clear notifications when garage door closes
  - entity_id: cover.garage_doors
    to: 'closed'
    trigger: state
  actions:
  - choose:
    # Handle close garage action
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.action == "close_garage_door" }}'
      sequence:
      - choose:
        # Only close if garage is still open
        - conditions:
          - condition: state
            entity_id: cover.garage_doors
            state: 'open'
          sequence:
          - data: {}
            target:
              entity_id: cover.garage_doors
            action: cover.close_cover
          - data:
              message: "Garage door is closing..."
            action: "notify.{{ trigger.event.data.sourceDeviceID }}"
        # If already closed, just acknowledge
        default:
        - data:
            message: "Garage door is already closed."
          action: "notify.{{ trigger.event.data.sourceDeviceID }}"
      # Clear the notification
      - data:
          message: "clear_notification"
          data:
            tag: "garage_open_dark"
        action: "notify.{{ trigger.event.data.sourceDeviceID }}"
    # Handle ignore action
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.action == "ignore_garage_notification" }}'
      sequence:
      - data:
          message: "clear_notification"
          data:
            tag: "garage_open_dark"
        action: "notify.{{ trigger.event.data.sourceDeviceID }}"
    # Auto-clear when garage closes
    - conditions:
      - condition: template
        value_template: '{{ trigger.entity_id == "cover.garage_doors" }}'
      sequence:
      # Clear notifications from both parents' devices
      - parallel:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.notify_fpm_andy
              state: 'on'
            sequence:
            - data:
                message: "clear_notification"
                data:
                  tag: "garage_open_dark"
              action: notify.mobile_app_salmob1
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.notify_fpm_katie
              state: 'on'
            sequence:
            - data:
                message: "clear_notification"
                data:
                  tag: "garage_open_dark"
              action: notify.mobile_app_salmob2
        # Clear Google Hub notification
        - sequence:
          - data: {}
            target:
              entity_id: input_boolean.garage_hub_notification_active
            action: input_boolean.turn_off
          # - data:
          #     message: "Garage door is now closed."
          #     target:
          #     - kitchen
          #   action: notify.google_assistant_sdk
  mode: single
- id: 'google_assistant_garage_voice_control'
  alias: Google Assistant Garage Voice Control
  description: Handle voice commands to close garage door when notification is active
  triggers:
  - event_type: google_assistant_command
    event_data:
      command: "close the garage door"
    trigger: event
  - event_type: google_assistant_command
    event_data:
      command: "close garage door"
    trigger: event
  - event_type: google_assistant_command
    event_data:
      command: "shut the garage door"
    trigger: event
  conditions:
  - condition: state
    entity_id: input_boolean.garage_hub_notification_active
    state: 'on'
  - condition: state
    entity_id: cover.garage_doors
    state: 'open'
  actions:
  - data: {}
    target:
      entity_id: cover.garage_doors
    action: cover.close_cover
  - data:
      message: "Closing the garage door now."
      target:
      - kitchen
    action: notify.google_assistant_sdk
  - data: {}
    target:
      entity_id: input_boolean.garage_hub_notification_active
    action: input_boolean.turn_off
  mode: single
- id: garage_lights_auto_off
  alias: Auto Turn Off Garage Lights When Empty
  description: 'Turn off garage lights when no person is detected for 15 minutes and lights are on'
  triggers:
  - entity_id: binary_sensor.garage_person_occupancy
    from: 'on'
    to: 'off'
    trigger: state
    for: '00:15:00'  # Wait 15 minutes before turning off lights
  conditions:
  - condition: state
    entity_id: switch.garage_lights
    state: 'on'
  actions:
  - entity_id: switch.garage_lights
    action: switch.turn_off
  mode: single